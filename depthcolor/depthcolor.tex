\chapter{Depth-Color Fusion} \label{depthcolor}

Chapter \ref{system} presented an integrated vision system that introduces representations for images and 
camera sensors in the \RD{} development platform. In this chapter these representations are used to create
new vision-related entities. It focuses specifically on merging the representations of the color and 3D 
time-of-flight cameras with the goal of creating a new camera that provides color and depth information. 

To achieve this, it is necessary to describe an algorithm that finds correspondences between points in the 
color camera and points in the 3D camera. The first part of this chapter, Section \ref{cameras}, gives an 
overview of the setup and discusses the type of data acquired by these cameras. Then, Section \ref{algorithm} 
provides a detailed description of the depth-color fusion algorithm, using as reference the work by Linarth 
\textit{et al.} \cite{Linarth}. This algorithm consists of extracting the cameras' parameters through synchronized 
camera calibration, computing the relative transformation between both cameras, and finding the 
correspondences between color and depth pixels.

Finally, Section \ref{implementation} discusses the implementation of the fusion algorithm as part of the 
integrated vision system. This section introduces the new depth-color camera representation, as well as the
entities that are needed to perform the synchronized camera calibration and the fusion between the depth 
and color images.


\section{Cameras Setup} \label{cameras}
\input{depthcolor/cameras}

\section{Fusion Algorithm} \label{algorithm}
\input{depthcolor/algorithm}

\section{Implementation in the Vision System} \label{implementation}
	
The vision system described in Chapter \ref{system} provides the core structure needed to implement the 
depth-color fusion algorithm. The implementation is introduced in the form of a new camera object that 
provides fused depth-color images. The following sections discuss the classes that make up this 
representation, and the module dependency diagram in Figure \ref{depthcolorcammoduledependency} 
illustrates how they are related to the components of the vision system.

\begin{figure}[t]
\begin{center}
\includegraphics[width = 15cm]{DepthColorCam.png}
%\input{depthcolor/img/depthcolorcam_moduledependency}
\caption[\DepthColorCam{}'s module dependency diagram]{\DepthColorCam{} module dependency diagram. 
Arcs with white arrows represent subtype relations (A $\vartriangleright$ B = A extends B) while arcs with 
black arrows represent implementation relations (A $\blacktriangleright$ B = A uses B). Gray rectangles 
represent abstract classes. The \ImageBuffer{} class is omitted from this diagram.}
\label{depthcolorcammoduledependency}
\end{center}
\end{figure}

	\subsection{Depth-Color Camera} \label{depthcolorcam}
	\input{depthcolor/depthcolorcam}
	
	\subsection{Depth-Color Calibration Tool} \label{depthcolorcalibrationtool}
	\input{depthcolor/depthcolorcalibrationtool}
	
	\subsection{Depth-Color Fusion} \label{depthcolorfusion}
	\input{depthcolor/depthcolorfusion}



